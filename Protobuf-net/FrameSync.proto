syntax = "proto3";
package FrameSync;

// 基础向量信息
message Vector3 {
    float x = 1;
    float y = 2;
    float z = 3;
}

// 玩家输入
message PlayerInput {
    int32 player_id = 1;
    int32 frame_number = 2; // 关键：帧序号，用于解决乱序
    float move_x = 3;
    float move_y = 4;
    bool fire = 5;
    bool jump = 6;
    uint64 timestamp = 7; // 客户端发送时间戳
}

// 游戏状态（服务器广播）
message GameState {
    int32 frame_number = 1;
    repeated PlayerState players = 2;
    uint64 server_time = 3;
}

// 单个玩家状态
message PlayerState {
    int32 player_id = 1;
    Vector3 position = 2;
    Vector3 velocity = 3;
    int32 health = 4;
}

// 网络层包装消息（推荐！）
message NetworkPacket {
    PacketType type = 1; // 消息类型
    int32 sequence = 2; // 序列号（用于可靠UDP）
    int32 ack = 3; // 确认号
    bytes payload = 4; // 实际消息数据
    
    enum PacketType {
        INPUT = 0;
        STATE = 1;
        COMMAND = 2;
        ACK = 3;
        HEARTBEAT = 4;
    }
}

// 连接管理消息
message Connection {
    int32 client_id = 1;
    string player_name = 2;
    bool is_reconnect = 3;
}
